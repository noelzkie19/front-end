/* eslint-disable no-unused-expressions */

/* eslint-disable no-undef */
window.lpTag=window.lpTag||{},lpTag.taglets=lpTag.taglets||{},lpTag.agentSDK=lpTag.agentSDK||function(){function e(e,i){if(e&&r&&i){s("binding on "+i);try{r.bind({appName:a.events,eventName:i,func:t(e,i+" event")})}catch(e){n("Error binding on "+i+". The error: "+JSON.stringify(e))}}else r||n("No channel defined when binding on "+i+'. Maybe you are missing a call to "init"?')}function t(e,t,i){return function(s){if(e&&(void 0!==s||!i))try{e.call(this,s)}catch(e){n("Callback provided for "+t+" encountered an error. The error: "+JSON.stringify(e)+" . The callback data: "+JSON.stringify(s))}}}function i(e,t){window.lpTag&&lpTag.log&&lpTag.log(e,t,o)}function n(e){i(e,"ERROR")}function s(e){i(e,"INFO")}var r,o="agentSDK",a={manager:"iFrame manager",events:"iFrame events"},h={bind:"Bind",unbind:"Unbind",write:"Write ChatLine",writeSC:"Write StructuredContent",notify:"Send Notification",initialize:"Initialize"},c={get:"Get",setConsumerProfile:"Set Consumer Profile",setChatNote:"Set Chat Note"},l={notify:"Notify",visitorFocused:"Visitor Focused",visitorBlurred:"Visitor Blurred"};return{v:"1.0.1",name:o,init:function(t){if(r=function(){if(lpTag.Chronos?.PostMessageCourier){s("Creating an instance of the courier");try{return new lpTag.Chronos.PostMessageCourier}catch(e){n("Error creating instance of courier")}}return}(),e(t&&t.notificationCallback,l.notify),e(t&&t.visitorFocusedCallback,l.visitorFocused),e(t&&t.visitorBlurredCallback,l.visitorBlurred),r)try{r.command({appName:a.manager,cmdName:h.initialize,data:{}})}catch(e){console.log("Leo Error:"),n("Error initializing communication. The error: "+e)}},get:function(e,i,o){var h=t(i,"'get' success"),l=t(o,"'get' error",!0);if(r&&e){s('Calling "get" on the following key: '+e);try{r.request({appName:a.manager,reqName:c.get,data:{key:e}},(function(e,t){e&&l(e),h(t)}))}catch(t){n('Error calling "get" on the following key: '+e+". The error: "+t),l(t)}}else{var u;r?e||(u='No key provided when calling "get"'):u='No channel defined when calling "get". Maybe you are missing a call to "init"?',u&&(n(u),l(u))}},bind:function(e,i,o){var c=t(i,"'bind' valueUpdateCallback"),l=t(o,"'bind' notifyWhenDoneCallback");if(r&&e){s('Calling "bind" on the following key: '+e);try{r.bind({appName:a.manager,eventName:e,func:c}),r.command({appName:a.manager,cmdName:h.bind,data:{key:e}},l)}catch(t){n('Error calling "bind" on the following key: '+e+". The error: "+t),l(t)}}else{var u;r?e||(u='No key provided when calling "bind"'):u='No channel defined when calling "bind". Maybe you are missing a call to "init"?',u&&(n(u),l(u))}},unbind:function(e,i,o){var c=t(i,"'bind' valueUpdateCallback"),l=t(o,"'bind' notifyWhenDoneCallback");if(r&&e){s('Calling "unbind" on the following key: '+e);try{r.unbind({appName:a.manager,eventName:e,func:c}),r.command({appName:a.manager,cmdName:h.unbind,data:{key:e}},l)}catch(t){n('Error calling "unbind" on the following key: '+e+". The error: "+t),l(t)}}else{var u;r?e||(u='No key provided when calling "unbind"'):u='No channel defined when calling "unbind". Maybe you are missing a call to "init"?',u&&(n(u),l(u))}},command:function(e,i,o){var h=t(o,"'command' notifyWhenDoneCallback");if(r&&e){s('Calling "command" with the following cmdName: '+e);try{r.command({appName:a.manager,cmdName:e,data:i},h)}catch(t){n('Error calling "command" with the following cmdName: '+e+". The error: "+t),h(t)}}else{var c;r?e||(c='No cmdName provided when calling "command"'):c='No channel defined when calling "command". Maybe you are missing a call to "init"?',c&&(n(c),h(c))}},request:function(e,i,o,h){var c=t(o,"'request' success"),l=t(h,"'request' error",!0);if(r&&e&&i&&Object.keys(i).length){s('Calling "request" with the following reqName: '+e);try{r.request({appName:a.manager,reqName:e,data:i},(function(e){return e?l(e):c()}))}catch(t){n('Error calling "request" with the following reqName: '+e+". The error: "+t),l(t)}}else{var u;r?e?i||(u='No data provided when calling "request" with the following reqName: '+e):u='No reqName provided when calling "request"':u='No channel defined when calling "request". Maybe you are missing a call to "init"?',u&&(n(u),l(u))}},dispose:function(){if(r&&r.dispose)try{r.dispose()}catch(e){n("Error disposing of the courier. The error: "+e)}r=null},onNotify:function(t){e(t,l.notify)},onVisitorFocused:function(t){e(t,l.visitorFocused)},onVisitorBlurred:function(t){e(t,l.visitorBlurred)},setConsumerProfile:function(e,t,i){this.request("Set Consumer Profile",e,t,i)},appNames:a,eventNames:l,cmdNames:h,reqNames:c}}(),function(e,t){"use strict";"function"==typeof define&&define.amd?define("Chronos.EventsUtil",[],(function(){return t(e,e,!0)})):"object"==typeof exports?t(e,exports):(e.Chronos=e.Chronos||{},t(e,e.Chronos))}(void 0===window.lpTag?this:window.lpTag,(function(e,t,i){"use strict";function n(t,i,n){e&&"function"==typeof e.log&&e.log(t,i,n)}function s(e){var t={};if(e.constructor===Object)for(var i in e)e.hasOwnProperty(i)&&null!==e[i]&&void 0!==e[i]&&("object"==typeof e[i]&&e[i].constructor!==Array?t[i]=s(e[i]):e[i].constructor===Array?t[i]=e[i].slice(0)||[]:"function"!=typeof e[i]&&(t[i]=null!==e[i]&&void 0!==e[i]?e[i]:""));else e.constructor===Array?t=e.slice(0)||[]:"function"!=typeof e&&(t=e);return t}function r(e,t,i,s){var r=[];if(e&&e.length)for(var o=0;o<e.length;o++)try{var a=!i&&e[o].func===t,h=!t&&i&&e[o].context===i,c=t&&i&&e[o].func===t&&e[o].context===i,l=s&&s===e[o].appName,u="*"===e[o].appName;if(a||h||c){if(l||u)continue;if(h)continue}else if(!t&&!i&&l)continue;r.push(e[o])}catch(e){n("Error in unbind e="+e.message,"ERROR","Events")}return r}var o={getListeners:function(e,t,i){var n=[];if(e[t]&&e[t].length)for(var s=0;s<e[t].length;s++)i&&"*"!==e[t][s].appName&&e[t][s].appName!==i||n.push(e[t][s]);if(e["*"])for(var r=0;r<e["*"].length;r++)i&&"*"!==e["*"][r].appName&&e["*"][r].appName!==i||n.push(e["*"][r]);return n},log:n,unbind:function(e){var t,i=e.unbindObj[e.attrName],s=!1;if(!e.unbindObj)return n("CMD listen id not spec for unbind","ERROR",e.loggerName),null;if("string"==typeof e.unbindObj)return function(e,t){var i=!1;if(!t)return n("Ev listen id not spec for unregister","ERROR","Events"),null;for(var s in e)if(e.hasOwnProperty(s))for(var r=0;r<e[s].length;r++)if(e[s][r].id==t){e[s].splice(r,1),n("Ev listen="+t+" and name="+s+" unregister","DEBUG","Events"),i=!0;break}return i||n("Ev listen not found "+t+" unregister","DEBUG","Events"),i}(e.lstnrs,e.unbindObj);if(!e.unbindObj.func&&!e.unbindObj.context&&!e.unbindObj.appName)return!1;var o=e.lstnrs;for(var a in (i&&((o={})[i]=e.lstnrs[i]), o))o.hasOwnProperty(a)&&o[a]&&o[a].length&&(t=r(o[a],e.unbindObj.func,e.unbindObj.context,e.unbindObj.appName)).length!==o[a].length&&(e.lstnrs[a]=t,s=!0);return s},hasFired:function(e,t,i){if((void 0===i||"*"===i)&&"*"===t)return e;for(var n=[],s=0;s<e.length;s++)(e[s].eventName===i||"*"===i)&&(t&&t===e[s].appName||!e[s].appName||"*"===e[s].appName||"*"===t)&&n.push(e[s]);return n},cloneEventData:s,storeEventData:function(e){if(0===e.eventBufferLimit||e.triggerData.data&&e.triggerData.data.doNotStore)e=null;else{var t={eventName:e.triggerData[e.attrName],appName:e.triggerData.appName};t.data=e.triggerData.passDataByRef?e.triggerData.data:s(e.triggerData.data),e.eventBufferLimit>0?(e.index>=e.eventBufferLimit&&(e.index=0),e.fired[e.index]=t,e.index++):e.fired.push(t),e=null}}};return i||(t.EventsUtil=t.EventsUtil||o),o})),function(e,t){"use strict";"function"==typeof define&&define.amd?define("Chronos.Events",["Chronos.EventsUtil"],(function(i){return t(e,e,i,!0)})):"object"==typeof exports?t(e,exports,require("./util/EventsUtil").EventsUtil):(e.Chronos=e.Chronos||{},t(e,e.Chronos,e.Chronos.EventsUtil))}(void 0===window.lpTag?this:window.lpTag,(function(e,t,i,n){"use strict";function s(e){function t(e,n,s){var r=e;if("string"==typeof e&&(r={appName:e,eventName:n,func:s}),r.appName=r.appName||c,"*"!==c&&("string"!=typeof e||"function"!=typeof n&&void 0!==n||(r.eventName=e)),!r.eventName||!r.func||"function"!=typeof r.func&&r.func.constructor!==Array)return i.log("Ev listen has invalid params: evName=["+r.eventName+"]","ERROR","Events"),null;if(r.func.constructor===Array){for(var o,a,h=[],l=0;l<r.func.length;l++)(o=i.cloneEventData(r)).func=r.func[l],a=t(o),h.push(a);return h}var u=m+d++,p={id:u,func:r.func,context:r.context||null,aSync:!!r.aSync,appName:r.appName,triggerOnce:r.triggerOnce||!1};return f[r.eventName]=f[r.eventName]||[],f[r.eventName].push(p),i.log("Ev listen rgstr: evName=["+r.eventName+"] aSync="+p.aSync+" appName="+p.name,"DEBUG","Events"),r=null,e=null,u}function n(e){return"*"!==c&&(e.appName=e.appName||c),i.unbind({unbindObj:e,attrName:u,loggerName:l,lstnrs:f})}function s(e,t,n){var s=e;if("string"==typeof e&&(s={eventName:t,appName:e,data:n}),"*"!==c&&(s.appName=s.appName||c,"string"!=typeof e||"object"!=typeof t&&void 0!==t||(s.eventName=e)),!s||void 0===s.eventName)return i.log("Ev name not spec for publish","ERROR","Events"),s=null,null;s.passDataByRef=s.passDataByRef||!a,o(s);var h=i.getListeners(f,s.eventName,s.appName);if(h.length>0)for(var l=0;l<h.length;l++){var u=s.passDataByRef?s.data:i.cloneEventData(s.data),d={appName:s.appName,eventName:s.eventName},p=h[l];p.aSync||u&&u.aSync?setTimeout(r(p,u,d),0):r(p,u,d)()}return s=null,h.length>0}function r(e,t,s){return function(){try{e.func.call(e.context,t,s),t=null,e.triggerOnce&&n(e),e=null}catch(t){i.log("Error executing "+s.eventName+" eventId: "+e.id+"e="+t.message,"ERROR","Events")}}}function o(e){i.storeEventData({triggerData:e,eventBufferLimit:h,attrName:u,fired:p,index:g})}var a,h,c,l="Events",u="eventName",d=0,f={},p=[],m="evId_",g=0;c=e&&e.appName||"*",a=!(!e||"boolean"!=typeof e.cloneEventData)&&e.cloneEventData,h=e&&!isNaN(e.eventBufferLimit)?e.eventBufferLimit:-1,this.once=function(e){return e?(e.triggerOnce=!0,t(e)):null},this.hasFired=function(e,t){return void 0===t&&(t=e,e=c),i.hasFired(p,e,t)},this.trigger=s,this.publish=s,this.bind=t,this.register=t,this.unbind=n,this.unregister=n}return n||(t.Events=t.Events||s),s})),function(e,t){"use strict";"function"==typeof define&&define.amd?define("Chronos.CommandsUtil",["Chronos.EventsUtil"],(function(i){return t(e,e,i,!0)})):"object"==typeof exports?t(e,exports,require("./EventsUtil").EventsUtil):(e.Chronos=e.Chronos||{},t(e,e.Chronos,e.Chronos.EventsUtil))}(void 0===window.lpTag?this:window.lpTag,(function(e,t,i,n){"use strict";function s(e,t){return!(t&&"*"===t||e.appName&&"*"===e.appName)}var r={bind:function(e){var t=e.cmd[e.attrName];if(!t||!e.cmd.func||"function"!=typeof e.cmd.func||!s(e.cmd,t))return i.log("comply: has invalid params: command=["+t+"]","ERROR",e.loggerName),null;if(e.lstnrs[t]&&e.lstnrs[t].length)return i.log("comply: cannot comply because command already exist command="+t,"ERROR",e.loggerName),null;var n=e.prefix+e.id++,r={id:n,func:e.cmd.func,context:e.cmd.context||null,appName:e.cmd.appName};return e.lstnrs[t]=e.lstnrs[t]||[],e.lstnrs[t].push(r),i.log("Cmd comply: evName=["+t+"] appName="+r.appName,"DEBUG",e.loggerName),n},valid:s};return n||(t.CommandsUtil=t.CommandsUtil||r),r})),function(e,t){"use strict";"function"==typeof define&&define.amd?define("Chronos.Commands",["Chronos.EventsUtil","Chronos.CommandsUtil"],(function(i,n){return t(e,e,i,n,!0)})):"object"==typeof exports?t(e,exports,require("./util/EventsUtil").EventsUtil,require("./util/CommandsUtil").CommandsUtil):(e.Chronos=e.Chronos||{},t(e,e.Chronos,e.Chronos.EventsUtil,e.Chronos.CommandsUtil))}(void 0===window.lpTag?this:window.lpTag,(function(e,t,i,n,s){"use strict";function r(e){function t(e){i.storeEventData({triggerData:e,eventBufferLimit:r,attrName:h,fired:u,index:f})}var s,r,o,a="Commands",h="cmdName",c=0,l={},u=[],d="cmdId_",f=0;o=e&&e.appName||"*",s=!(!e||"boolean"!=typeof e.cloneEventData)&&e.cloneEventData,r=e&&!isNaN(e.eventBufferLimit)?e.eventBufferLimit:-1,this.hasFired=function(e,t){return void 0===t&&(t=e,e=o),i.hasFired(u,e,t)},this.comply=function(e){return"*"!==o&&(e.appName=e.appName||o),n.bind({cmd:e,attrName:h,loggerName:a,prefix:d,id:c,lstnrs:l})},this.stopComplying=function(e){return"*"!==o&&(e.appName=e.appName||o),i.unbind({unbindObj:e,attrName:h,loggerName:a,lstnrs:l})},this.command=function(e,r){if(!e||void 0===e.cmdName||!n.valid(e,e.cmdName))return i.log("CMD name not spec for command","ERROR","Commands"),null;if("*"!==o&&(e.appName=e.appName||o),e.passDataByRef=e.passDataByRef||!s,t(e),!l[e.cmdName])return!1;var a=i.getListeners(l,e.cmdName,e.appName);if(a.length>0)for(var h=0;h<a.length;h++){var c=e.passDataByRef?e.data:i.cloneEventData(e.data),u=a[h];try{"function"==typeof r?u.func.call(u.context,c,r):u.func.call(u.context,c),c=null,u=null}catch(t){if("function"==typeof r)try{r(t)}catch(t){i.log("Error executing callback on error, "+e.cmdName+" commandId: "+u.id+"e="+t.message,"ERROR","Commands")}i.log("Error executing "+e.cmdName+" commandId: "+u.id+"e="+t.message,"ERROR","Commands")}}return a.length>0}}return s||(t.Commands=t.Commands||r),r})),function(e,t){"use strict";"function"==typeof define&&define.amd?define("Chronos.Reqres",["Chronos.EventsUtil","Chronos.CommandsUtil"],(function(i,n){return t(e,e,i,n,!0)})):"object"==typeof exports?t(e,exports,require("./util/EventsUtil").EventsUtil,require("./util/CommandsUtil").CommandsUtil):(e.Chronos=e.Chronos||{},t(e,e.Chronos,e.Chronos.EventsUtil,e.Chronos.CommandsUtil))}(void 0===window.lpTag?this:window.lpTag,(function(e,t,i,n,s){function r(e){function t(e){i.storeEventData({triggerData:e,eventBufferLimit:r,attrName:h,fired:u,index:f})}var s,r,o,a="ReqRes",h="reqName",c=0,l={},u=[],d="reqId_",f=0;o=e&&e.appName||"*",s=!(!e||"boolean"!=typeof e.cloneEventData)&&e.cloneEventData,r=e&&!isNaN(e.eventBufferLimit)?e.eventBufferLimit:-1,this.hasFired=function(e,t){return void 0===t&&(t=e,e=o),i.hasFired(u,e,t)},this.request=function(e,r){var a;if(!e||void 0===e.reqName||!n.valid(e,e.reqName))throw (i.log("request: name not spec for command","ERROR","ReqRes"), new Error("Invalid request object"));if("*"!==o&&(e.appName=e.appName||o),e.passDataByRef=e.passDataByRef||!s,t(e),!l[e.reqName])return a;var h=i.getListeners(l,e.reqName,e.appName);if(h.length>0)for(var c=0;c<h.length;c++){var u=e.passDataByRef?e.data:i.cloneEventData(e.data),d={appName:e.appName,reqName:e.reqName},f=h[c];try{a="function"==typeof r?f.func.call(f.context,u,r):f.func.call(f.context,u),u=null,f=null}catch(e){if("function"==typeof r)try{r(e)}catch(e){i.log("Error executing callback on error, "+d.reqName+" requestId: "+f.id+"e="+e.message,"ERROR","ReqRes")}i.log("Error executing "+d.reqName+" requestId: "+f.id+"e="+e.message,"ERROR","ReqRes")}}return a},this.reply=function(e){return"*"!==o&&(e.appName=e.appName||o),n.bind({cmd:e,attrName:h,loggerName:a,prefix:d,id:c,lstnrs:l})},this.stopReplying=function(e){return"*"!==o&&(e.appName=e.appName||o),i.unbind({unbindObj:e,attrName:h,loggerName:a,lstnrs:l})}}return s||(t.ReqRes=t.ReqRes||r),r})),function(e,t){"use strict";"function"==typeof define&&define.amd?define("Chronos.Channels",["Chronos.Events","Chronos.Commands","Chronos.Reqres"],(function(i,n,s){return t(e,e,i,n,s,!0)})):"object"==typeof exports?t(e,exports,require("./Events").Events,require("./Commands").Commands,require("./Reqres").ReqRes):(e.Chronos=e.Chronos||{},t(e,e.Chronos,e.Chronos.Events,e.Chronos.Commands,e.Chronos.ReqRes))}(void 0===window.lpTag?this:window.lpTag,(function(e,t,i,n,s,r){function o(e){function t(e){return function(){var t;e.func.apply(e.context,Array.prototype.slice.call(arguments,0));for(var i=0;i<r.length;i++)if((t=r[i])[e.triggerType])try{t[e.triggerType].apply(t.context,Array.prototype.slice.call(arguments,0))}catch(e){}}}var r=[],o=(e=e||{}).events||new i(e.config&&e.config.events),a=e.commands||new n(e.config&&e.config.commands),h=e.reqres||new s(e.config&&e.config.reqres);this.once=o.once,this.hasFiredEvents=o.hasFired,this.trigger=o.trigger,this.publish=o.publish,this.bind=o.bind,this.register=o.register,this.unbind=o.unbind,this.unregister=o.unregister,this.hasFiredCommands=a.hasFired,this.comply=a.comply,this.stopComplying=a.stopComplying,this.command=a.command,this.hasFiredReqres=h.hasFired,this.request=h.request,this.reply=h.reply,this.stopReplying=h.stopReplying,!0===e.externalProxy&&(this.trigger=t({func:o.trigger,context:o,triggerType:"trigger"}),this.publish=t({func:o.publish,context:o,triggerType:"trigger"}),this.registerProxy=function(e){"object"==typeof e&&e.trigger&&r.push(e)})}return r||(t.Channels=t.Channels||o),o})),function(e,t){"use strict";"function"==typeof define&&define.amd?define("CircuitBreaker",["exports"],(function(){return e.CircuitBreaker||t(e),e.CircuitBreaker})):t("object"==typeof exports?exports:e)}(void 0===window.lpTag?this:window.lpTag,(function(e){"use strict";function t(e){if(0==this instanceof t)return new t(e);this.initialize(e)}var i={OPEN:0,HALF_OPEN:1,CLOSED:2},n="failure",s="success",r="timeout",o="outage";t.prototype=function(){function e(){return i.OPEN===this.state}function t(){for(var e,t=0,i=0,o=0;o<this.buckets.length;o++)i+=e=this.buckets[o][n]+this.buckets[o][r],t+=e+this.buckets[o][s];return{total:t,error:i,percent:i/(t>0?t:1)*100}}function a(){this.timer&&clearTimeout(this.timer),u.call(this),this.bucketIndex>this.bucketsNumber&&(this.bucketIndex=0,e.call(this)&&(this.state=i.HALF_OPEN)),this.timer=setTimeout(a.bind(this),this.bucket)}function h(){this.bucketIndex=0,this.bucket=this.slidingTimeWindow/this.bucketsNumber,this.timer&&clearTimeout(this.timer),this.timer=setTimeout(a.bind(this),this.bucket)}function c(){var e={};return e[n]=0,e[s]=0,e[r]=0,e[o]=0,e}function l(){return this.buckets[this.buckets.length-1]}function u(){this.bucketIndex++,this.buckets.push(c.call(this)),this.buckets.length>this.bucketsNumber&&this.buckets.shift()}function d(e,t){return function(){t.done||(t.timer&&(clearTimeout(t.timer),t.timer=null,delete t.timer),l.call(this)[e]++,this.forced||m.call(this),t.done=!0)}.bind(this)}function f(e,t){var i={done:!1},o=d.call(this,s,i),a=d.call(this,n,i),h=d.call(this,r,i);(t=!isNaN(t)&&t>0?parseInt(t,10):this.timeout)>0&&(i.timer=setTimeout(h,t));try{e(o,a,h)}catch(e){a()}}function p(e){try{e()}catch(e){}l.call(this)[o]++}function m(){var e=t.call(this);if(i.HALF_OPEN===this.state){!l.call(this)[s]&&0<e.error?this.state=i.OPEN:(this.state=i.CLOSED,this.onclose(e))}else{var n=e.percent>this.tolerance;e.total>this.calibration&&n&&(this.state=i.OPEN,this.onopen(e))}}return{initialize:function(e){this.initialized||(e=e||{},this.slidingTimeWindow=!isNaN(e.slidingTimeWindow)&&0<e.slidingTimeWindow?parseInt(e.slidingTimeWindow,10):3e4,this.bucketsNumber=!isNaN(e.bucketsNumber)&&0<e.bucketsNumber?parseInt(e.bucketsNumber,10):10,this.tolerance=!isNaN(e.tolerance)&&0<e.tolerance?parseInt(e.tolerance,10):50,this.calibration=!isNaN(e.calibration)&&0<e.calibration?parseInt(e.calibration,10):5,this.timeout=!isNaN(e.timeout)&&0<e.timeout?parseInt(e.timeout,10):0,this.onopen="function"==typeof e.onopen?e.onopen:function(){},this.onclose="function"==typeof e.onclose?e.onclose:function(){},this.buckets=[c.call(this)],this.state=i.CLOSED,this.initialized=!0,h.call(this))},run:function(t,i,n){return i&&"function"!=typeof i&&(n=i,i=void 0),e.call(this)?(p.call(this,i||function(){}),!1):f.call(this,t,n)},close:function(){this.forced=this.state,this.state=i.CLOSED},open:function(){this.forced=this.state,this.state=i.OPEN},reset:function(){this.state=this.forced,this.forced=void 0},isOpen:e,calculate:t}}(),t.STATE=i,Function.prototype.bind||(Function.prototype.bind=function(e){function t(){}function i(){return s.apply(this instanceof t&&e?this:e,n.concat(Array.prototype.slice.call(arguments)))}var n,s;if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");return n=Array.prototype.slice.call(arguments,1),s=this,t.prototype=this.prototype,i.prototype=new t,i}),e.CircuitBreaker=e.CircuitBreaker||t})),function(e,t){"use strict";"function"==typeof define&&define.amd?define("cacher",["exports"],(function(){return e.Cacher||t(e),e.Cacher})):t("object"==typeof exports?exports:e)}(void 0===window.lpTag?this:window.lpTag,(function(e){"use strict";function t(e){if(0==this instanceof t)return new t(e);this.initialize(e)}t.prototype=function(){function e(e,t,i,s){return n.call(this,e,t,i,s)}function t(e){var t=this.cache&&this.cache[e]&&this.cache[e].item;return t&&(this.cache[e].item=null,this.cache[e].callback=null,this.cache[e].timeout=null,this.cache[e]=null,delete this.cache[e],this.length--,i.call(this,"remove",e)),t}function i(e,t,i,n){if(!this.nostore)for(var s=0;s<this.stores.length;s++)this.stores[s][e]?this.stores[s][e](t,i,n):this.stores[s].save&&this.stores[s].save({items:this.cache})}function n(e,t,n,r){var o,a;return(0===this.max||this.length<this.max)&&(o=isNaN(n)?this.ttl:parseInt(n,10),this.cache[e]={item:t},this.length++,o&&(a=(new Date).getTime()+o,this.cache[e].timeout=a),"function"==typeof r&&(this.cache[e].callback=r),i.call(this,"set",e,t,n),o&&(this.cache[e].callback||"function"==typeof this.ontimeout)&&s.call(this),!0)}function s(){var e,i,n,r;if(this.timer&&clearTimeout(this.timer),this.length)for(var o in this.cache)this.cache.hasOwnProperty(o)&&this.cache[o].timeout&&this.cache[o].timeout<=(new Date).getTime()&&(i=this.cache[o].item,(e=this.cache[o].callback)&&(n=e(o,i)),this.ontimeout&&(r=this.ontimeout(o,i)),!1!==n&&!1!==r&&t.call(this,o));this.timer=setTimeout(s.bind(this),this.interval)}return{initialize:function(t){function i(t,i){n.nostore=!0,e.call(n,i.key,i.value,i.ttl),delete n.nostore}var n=this,r=!1,o=0;if(!this.initialized){for(t=t||{},this.cache={},this.length=0,this.max=!isNaN(t.max)&&0<t.max?parseInt(t.max,10):0,this.ttl=!isNaN(t.ttl)&&0<t.ttl?parseInt(t.ttl,10):0,this.interval=!isNaN(t.interval)&&0<t.interval?parseInt(t.interval,10):1e3,this.ontimeout="function"==typeof t.ontimeout?t.ontimeout:function(){},this.stores=t.stores||[];o<this.stores.length&&!r;)this.stores[o].autoload&&this.stores[o].load&&(r=!0,this.stores[o].load({onitem:i,oncomplete:t.oncomplete})),o++;this.initialized=!0,s.call(this)}},get:function(e,i){return i?t.call(this,e):this.cache&&this.cache[e]&&this.cache[e].item},set:e,remove:t,removeAll:function(){if(this.length)for(var e in this.cache)this.cache.hasOwnProperty(e)&&t.call(this,e)}}}(),e.Cacher=e.Cacher||t})),function(e,t,i){"use strict";"function"==typeof define&&define.amd?define("Chronos.PostMessageUtilities",[],(function(){return i(e,t,!0)})):"object"!=typeof exports&&(t.Chronos=t.Chronos||{},i(e,t.Chronos))}(this,void 0===window.lpTag?this:window.lpTag,(function(e,t,i){"use strict";function n(e,t){return!isNaN(e)&&e>0?parseInt(e,10):t}function s(e,t,i){var n,s,r,o=new RegExp(/(http{1}s{0,1}?:\/\/)([^\/\?]+)(\/?)/gi);return e&&0===e.indexOf("http")?((n=o.exec(e))&&3<=n.length&&""!==n[2]&&(s=n[1].toLowerCase()+n[2].toLowerCase()),s):(r=i?t.top||t.contentWindow&&t.contentWindow.parent||window:t).location.protocol+"//"+r.location.host}function r(e,t){var i,n=o("lpHost",t);return n||(i=o("hostParam",t)||e)&&(n=o(i,t)),n}function o(e,t){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(t||document.location.search)||[void 0,""])[1].replace(/\+/g,"%20"))||null;}function a(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent("on"+t,i)}function h(t,i,n){e&&"function"==typeof e.log&&e.log(t,i,n)}function c(e){function t(){}function i(){return s.apply(this instanceof t&&e?this:e,n.concat(Array.prototype.slice.call(arguments)))}var n,s;if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");return n=Array.prototype.slice.call(arguments,1),s=this,t.prototype=this.prototype,i.prototype=new t,i}Function.prototype.bind||(Function.prototype.bind=c);var l={SEQUENCE_FORMAT:"_xxxxxx-4xxx-yxxx",stringify:function(){var e,t;if("function"==typeof Array.prototype.toJSON){t=Array.prototype.toJSON,Array.prototype.toJSON=void 0;try{e=JSON.stringify.apply(null,arguments)}catch(e){throw (Array.prototype.toJSON=t, e)}Array.prototype.toJSON=t}else e=JSON.stringify.apply(null,arguments);return e},hasPostMessageObjectsSupport:function(){var t=!0;try{e.postMessage({toString:function(){t=!1}},"*")}catch(e){e&&"DataCloneError"!==e.name&&(t=!1)}return t},createUniqueSequence:function(e){return e&&e.replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));},parseNumber:n,parseFunction:function(e,t){return"function"==typeof e?e:!0===t?function(){}:t},getHost:s,resolveOrigin:function(e,t,i){var n,o,a;try{o=e&&e.contentWindow&&"undefined"!=typeof Window&&!(e instanceof Window)&&e.getAttribute&&e.getAttribute("src")}catch(e){}try{o||(o=r(i)),o||(o=document.referrer,a=!0),o&&(o=decodeURIComponent(o),a&&(o=r(i,o))),n=s(o,e,t)}catch(e){h("Cannot parse origin","ERROR","PostMessageUtilities")}return n||"*"},getURLParameter:o,delay:function(e,t){var i;return"undefined"!=typeof setImmediate&&(isNaN(t)||0>=t)?i=setImmediate(e):!1===t?e():i=setTimeout(e,isNaN(t)||0>=t?0:parseInt(t,10)),function(){!function(e){var t=n(e);t&&("undefined"!=typeof clearImmediate?clearImmediate(t):clearTimeout(t))}(i)}},addEventListener:function(e,t,i){return e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i),function(){a(e,t,i)}},removeEventListener:a,log:h,bind:c};return i||(t.PostMessageUtilities=t.PostMessageUtilities||l),l})),function(e,t,i){"use strict";"function"==typeof define&&define.amd?define("Chronos.PostMessageChannelPolyfill",["Chronos.PostMessageUtilities"],(function(n){return i(e,t,n,!0)})):"object"!=typeof exports&&(t.Chronos=t.Chronos||{},i(e,t.Chronos,t.Chronos.PostMessageUtilities))}(this,void 0===window.lpTag?this:window.lpTag,(function(e,t,i,n){"use strict";function s(e,t){if(0==this instanceof s)return new s(e,t);this.initialize(e,t)}var r="LPPort_";return s.prototype=function(){function t(){return this.origin||(this.origin=i.resolveOrigin(this.target)),this.origin}function n(e){return{port:this.portId,message:e}}function s(e){var t;if(e&&e.data)try{if((t=this.deserialize(e.data)).port&&0===t.port.indexOf(r))return{origin:e.origin,data:t.message}}catch(e){i.log("Error while trying to deserialize the message","ERROR","PostMessageChannelPolyfill")}return t||e}return{initialize:function(t,n){this.initialized||(n=n||{},this.target=t||e.top,this.hosted=this.target===e||this.target===e.top,this.portId=i.createUniqueSequence(r+i.SEQUENCE_FORMAT),this.serialize=i.parseFunction(n.serialize,i.stringify),this.deserialize=i.parseFunction(n.deserialize,JSON.parse),this.initialized=!0)},postMessage:function(e){var s,r,o=t.call(this),a=this.target;if(e)try{this.hosted||(a=this.target.contentWindow),s=n.call(this,e),r=this.serialize(s),a.postMessage(r,o)}catch(e){return i.log("Error while trying to post the message","ERROR","PostMessageChannelPolyfill"),!1}},receive:function(e){var t;if("function"==typeof this.onmessage)return t=s.call(this,e),this.onmessage(t)}}}(),n||(t.PostMessageChannelPolyfill=t.PostMessageChannelPolyfill||s),s})),function(e,t,i){"use strict";"function"==typeof define&&define.amd?define("Chronos.PostMessageChannel",["Chronos.PostMessageUtilities","Chronos.PostMessageChannelPolyfill"],(function(n,s){return i(e,t,n,s,!0)})):"object"!=typeof exports&&(t.Chronos=t.Chronos||{},i(e,t.Chronos,t.Chronos.PostMessageUtilities,t.Chronos.PostMessageChannelPolyfill))}(this,void 0===window.lpTag?this:window.lpTag,(function(e,t,i,n,s){"use strict";function r(e,t){if(0==this instanceof r)return new r(e,t);this.initialize(e,t)}var o="LPTKN",a="HNDSK";return r.prototype=function(){function t(e,t){var n=i.parseFunction(this[e]);n&&(t||n.call(this),this[e]=void 0,delete this[e])}function s(e){t.call(this,"rmtimer",e)}function r(e){t.call(this,"rmload",e)}function h(t,s){var r;try{r=y.call(this)}catch(e){r=!1}r||(this.channel=!1,this.receiver=new n(this.target,{serialize:this.serialize,deserialize:this.deserialize}),this.receiver.onmessage=t,this.hosted||(s=u(t).bind(this),this.removeListener=i.addEventListener(e,"message",s)),y.call(this)),this.handshakeAttempts--,i.delay(function(){this.disposed||this.hosted||this.ready||(this.rmload=w.call(this,this.target),this.rmtimer=i.delay(y.bind(this,this.handshakeInterval),this.handshakeInterval))}.bind(this))}function c(t,n){var s;return l.call(this,t),s=function(e){return function(t){var n;if(!t.origin||"*"===t.origin||this.targetOrigin===t.origin){if(!g.call(this,t)||this.disposed||this.hosted||this.ready){try{if(n=this.deserialize(t.data),m.call(this,n))return e&&e(n)}catch(e){n=t.data||t,i.log("Error while trying to handle the message","ERROR","PostMessageChannel")}return n||t}b.call(this)}}}(n).bind(this),this.channelFactory=f.call(this,s),!t.target||(t.target!==e||t.target===e.top)&&"undefined"!=typeof Window&&t.target instanceof Window?(this.hosted=!0,this.target=t.target||e.top):t.target.contentWindow?this.target=t.target:t.target.url&&(this.targetUrl=t.target.url,this.targetOrigin=this.targetOrigin||i.getHost(t.target.url)),this.hosted||(this.token=i.createUniqueSequence(o+i.SEQUENCE_FORMAT)),this.targetUrl&&(this.loading=!0,this.targetContainer=t.target.container||document.body,this.target=N.call(this,t.target,this.targetContainer)),s}function l(e){this.serialize=i.parseFunction(e.serialize,i.stringify),this.deserialize=i.parseFunction(e.deserialize,JSON.parse),this.targetOrigin=e.targetOrigin,this.maxConcurrency=i.parseNumber(e.maxConcurrency,100),this.handshakeInterval=i.parseNumber(e.handshakeInterval,5e3),this.handshakeAttemptsOrig=i.parseNumber(e.handshakeAttempts,3),this.handshakeAttempts=this.handshakeAttemptsOrig,this.hostParam=e.hostParam,this.channel=void 0!==e.channel?e.channel:"true"!==i.getURLParameter("lpPMCPolyfill")&&void 0,this.useObjects=e.useObjects,this.onready=function(e,t){return function(i){t&&"function"==typeof t.callback&&t.callback.call(t.context,i,this.target),e&&("function"==typeof e?e(i,this.target):"function"==typeof e.callback&&e.callback.call(e.context,i,this.target))}}(e.onready,e.target).bind(this),this.removeDispose=e.removeDispose}function u(e){return function(t){var n,s;t.ports&&0<t.ports.length?(this.receiver=t.ports[0],g.call(this,t)&&(this.token||(this.token=t.data)),this.receiver.start(),s=this.removeListener.bind(this),this.removeListener=i.addEventListener(this.receiver,"message",e),s(),this.disposed||!this.hosted||this.ready||(n=!0)):g.call(this,t)?(this.token||(this.token=t.data),this.disposed||!this.hosted||this.ready||(n=!0)):this.token&&this.receiver.receive.call(this.receiver,t),n&&(this.receiver.postMessage(a+this.token),b.call(this))}}function d(e){return p.call(this,e),this.serialize(e)}function f(e){return function(){this.channel=new MessageChannel,this.receiver=this.channel.port1,this.dispatcher=this.channel.port2,this.receiver.onmessage=e,this.neutered=!1}.bind(this)}function p(e){this.token&&(e.token=this.token)}function m(e){return e&&e.token===this.token}function g(e){return e&&e.data&&"string"==typeof e.data&&(0===e.data.indexOf(o)||a+this.token===e.data)}function v(){return!1!==this.channel&&"undefined"!=typeof MessageChannel&&"undefined"!=typeof MessagePort}function y(e){if(s.call(this,!0),!this.disposed&&!this.ready&&(v.call(this)||(this.targetOrigin=this.targetOrigin||i.resolveOrigin(this.target)||"*"),!this.hosted))if(v.call(this))try{this.neutered&&this.channelFactory(),this.target.contentWindow.postMessage(this.token,this.targetOrigin,[this.dispatcher]),this.neutered=!0}catch(e){return!1}else this.target.contentWindow.postMessage(this.token,this.targetOrigin);return this.disposed||this.ready||!e||(0<this.handshakeAttempts?(this.handshakeAttempts--,this.rmtimer=i.delay(y.bind(this,e),e)):this.onready(new Error("Loading: Operation Timeout!"))),!0}function b(){this.disposed||this.ready||(this.ready=!0,this.handshakeAttempts=this.handshakeAttemptsOrig,this.messageQueue&&this.messageQueue.length?i.delay(function(){var e,t;if(!this.disposed&&this.ready){for(;this.messageQueue&&this.messageQueue.length;){e=this.messageQueue.shift();try{t=d.call(this,e),this.receiver.postMessage(t)}catch(e){i.log("Error while trying to post the message from queue","ERROR","PostMessageChannel")}}this.onready()}}.bind(this)):this.onready())}function C(t){var n=(t=t||{}).onready,s=t.doc||e.document,r=t.delay;i.delay((function e(){s.body?n():i.delay(e,r||100)}),r||!1)}function N(e,t){var n=document.createElement("IFRAME"),s=i.createUniqueSequence("LPFRM"+i.SEQUENCE_FORMAT),r=e.delayLoad,o={id:s,name:s,tabindex:"-1","aria-hidden":"true",title:"",role:"presentation",allowTransparency:"true"};for(var a in (e.attributes=e.attributes||o, e.attributes))e.attributes.hasOwnProperty(a)&&n.setAttribute(a,e.attributes[a]);if(e.style=e.style||{width:"0px",height:"0px",position:"absolute",top:"-1000px",left:"-1000px"},e.style)for(var h in e.style)e.style.hasOwnProperty(h)&&(n.style[h]=e.style[h]);return C({delay:r,onready:function(){(t||document.body).appendChild(n),this.rmload=w.call(this,n),E.call(this,n,e.url,!1!==e.bust)}.bind(this)}),n}function w(e){var t=function(){this.loading=!1,this.handshakeAttempts===this.handshakeAttemptsOrig&&(this.ready=!1),y.call(this,this.handshakeInterval)}.bind(this);return i.addEventListener(e,"load",t),function(){!function(e,t){i.removeEventListener(e,"load",t)}(e,t)}}function E(e,t,n){t+=0<t.indexOf("?")?"&":"?",n&&(t+="bust=",t+=(new Date).getTime()+"&"),t+=(this.hostParam?"hostParam="+this.hostParam+"&"+this.hostParam+"=":"lpHost=")+encodeURIComponent(i.getHost(void 0,e,!0)),v.call(this)||(t+="&lpPMCPolyfill=true"),!1===this.useObjects&&(t+="&lpPMDeSerialize=true"),e.setAttribute("src",t)}return{initialize:function(t,s){var r,o;this.initialized||(this.hosted=!1,this.messageQueue=[],t=t||{},o=c.call(this,t,s),v.call(this)||(this.receiver=new n(this.target,{serialize:this.serialize,deserialize:this.deserialize}),this.receiver.onmessage=o),this.hosted||!v.call(this)?(r=u(o).bind(this),this.removeListener=i.addEventListener(e,"message",r)):v.call(this)&&this.channelFactory(),!this.target||this.loading||this.ready||h.call(this,o,r),this.initialized=!0)},postMessage:function(e,t,n){var s,r;if(!this.disposed)try{if(e)return this.ready||n?(s=t||this.receiver,r=d.call(this,e),s.postMessage(r),!0):this.maxConcurrency>=this.messageQueue.length&&(this.messageQueue.push(e),!0)}catch(e){return i.log("Error while trying to post the message","ERROR","PostMessageChannel"),!1}},dispose:function(){if(!this.disposed){if(this.removeListener&&(this.removeListener.call(this),this.removeListener=void 0),this.targetUrl&&this.target||this.removeDispose)try{this.targetContainer?this.targetContainer.removeChild(this.target):document.body.removeChild(this.target)}catch(e){i.log("Error while trying to remove the iframe from the container","ERROR","PostMessageChannel")}s.call(this),r.call(this),this.messageQueue.length=0,this.messageQueue=void 0,this.channel=void 0,this.onready=void 0,this.disposed=!0}}}}(),s||(t.PostMessageChannel=r),r;})),function(e,t,i){"use strict";"function"==typeof define&&define.amd?define("Chronos.PostMessagePromise",["exports"],(function(){return i(e,t,!0)})):"object"!=typeof exports&&(t.Chronos=t.Chronos||{},i(e,t.Chronos))}(this,void 0===window.lpTag?this:window.lpTag,(function(e,t,i){"use strict";function n(e){if(0==this instanceof n)return new n(e);this.initialize(e)}var s="resolve",r="reject",o="progress";return n.prototype=function(){function e(e){a.call(this,s,e)}function t(e){a.call(this,r,e)}function i(e){n.call(this,o,e)}function n(e,t,i){var n,s;if(this.queue&&this.queue.length){for(n=0,s=this.queue[n++];s;)s[e]&&s[e].call(this,t),s=this.queue[n++];i&&(this.queue.length=0)}}function a(e,t){var i=this.actions[e];this.then=function(){i&&i.call(this,t)}.bind(this),this.resolve=this.reject=function(){throw new Error("This Promise instance had already been completed.")},this.progress=function(){return!1},n.call(this,e,t,!0),this.queue&&(this.queue.length=0,delete this.queue)}return{initialize:function(n){this.initialized||(this.queue=[],this.actions={resolve:e.bind(this),reject:t.bind(this),progress:i.bind(this)},"function"==typeof n&&n.call(this,this.actions.resolve,this.actions.reject),this.initialized=!0)},then:function(e,t,i){this.queue.push({resolve:e,reject:t,progress:i})},resolve:e,reject:t,progress:i}}(),n.polyfill=function(){e.Promise||(e.Promise=n)},i||(t.PostMessagePromise=t.PostMessagePromise||n),n})),function(e,t){"use strict";"function"==typeof define&&define.amd?define("Chronos.PostMessageMapper",["Chronos.PostMessageUtilities"],(function(i){return t(e,e,i,!0)})):"object"!=typeof exports&&(e.Chronos=e.Chronos||{},t(e,e.Chronos,e.Chronos.PostMessageUtilities))}(void 0===window.lpTag?this:window.lpTag,(function(e,t,i,n){"use strict";function s(e){if(0==this instanceof s)return new s(e);this.initialize(e)}return s.prototype=function(){function e(e){var t=e&&e.method,n=t&&t.name,s=t&&t.args,r=this.eventChannel;return function(){if(r&&r[n])return r[n].apply(r,s);i.log("No channel exists","ERROR","PostMessageMapper")}}return{initialize:function(e){this.initialized||(this.eventChannel=e,this.initialized=!0)},toEvent:function(t){if(t)return t.error?(i.log("Error on message: "+t.error,"ERROR","PostMessageMapper"),function(){return t}):e.call(this,t)},toMessage:function(e,t){return{method:{id:e,name:t,args:Array.prototype.slice.call(arguments,2)}}}}}(),n||(t.PostMessageMapper=t.PostMessageMapper||s),s})),function(e,t,i,n){"use strict";"function"==typeof define&&define.amd?define("Chronos.PostMessageCourier",["Chronos.PostMessageUtilities","Chronos.Channels","cacher","CircuitBreaker","Chronos.PostMessageChannel","Chronos.PostMessagePromise","Chronos.PostMessageMapper"],(function(t,i,s,r,o,a,h){return n(e,e,t,i,s,r,o,a,h,!0)})):"object"!=typeof exports&&(e.Chronos=e.Chronos||{},n(e,e.Chronos,e.Chronos.PostMessageUtilities,e.Chronos.Channels,t.Cacher,i.CircuitBreaker,e.Chronos.PostMessageChannel,e.Chronos.PostMessagePromise,e.Chronos.PostMessageMapper))}(void 0===window.lpTag?this:window.lpTag,void 0===window.lpTag?this:window.lpTag,void 0===window.lpTag?this:window.lpTag,(function(e,t,i,n,s,r,o,a,h,c){"use strict";function l(e){if(0==this instanceof l)return new l(e);this.initialize(e)}var u="trigger",d="command",f="request",p="return";return l.prototype=function(){function e(e){e&&"function"==typeof e.registerProxy&&e.registerProxy({trigger:function(){y.call(this,Array.prototype.slice.apply(arguments),u)},context:this})}function t(){if(!this.disposed){var e=Array.prototype.slice.apply(arguments);return(2!==arguments.length&&4!==arguments.length||!0!==arguments[arguments.length-1])&&this.eventChannel.trigger.apply(this.eventChannel,e),y.call(this,e,u)}}function c(e){this.useObjects=!1===e.useObjects?e.useObjects:"true"!==i.getURLParameter("lpPMDeSerialize")&&void 0,void 0===this.useObjects&&(this.useObjects=!0),e.useObjects=this.useObjects,"function"!=typeof e.serialize||"function"!=typeof e.deserialize?(this.useObjects&&i.hasPostMessageObjectsSupport()?(this.serialize=v,this.deserialize=v):(this.serialize=i.stringify,this.deserialize=JSON.parse),e.serialize=this.serialize,e.deserialize=this.deserialize):(this.serialize=e.serialize,this.deserialize=e.deserialize)}function l(e){var t;this.eventChannel=e.eventChannel||new n({events:e.events,commands:e.commands,reqres:e.reqres}),this.mapper=new h(this.eventChannel),t=P(this.mapper.toEvent.bind(this.mapper)).bind(this),this.messageChannel=new o(e,t)}function m(e){this.callbackCache=new s({max:i.parseNumber(e.maxConcurrency,100),ttl:i.parseNumber(e.timeout,3e4),interval:1e3})}function g(e){var t=i.parseNumber(e.messureTime,3e4);this.circuit=new r({timeWindow:t,slidesNumber:Math.ceil(t/100),tolerance:i.parseNumber(e.messureTolerance,30),calibration:i.parseNumber(e.messureCalibration,10),onopen:i.parseFunction(e.ondisconnect,!0),onclose:i.parseFunction(e.onreconnect,!0)})}function v(e){return e}function y(e,t){return this.circuit.run(function(i,n,s){var r=C.call(this,e,t,s);if(r)try{!1===this.messageChannel.postMessage.call(this.messageChannel,r)?n():i()}catch(e){n()}else n()}.bind(this))}function b(e,t){return this.circuit.run(function(i,n){try{!1===this.messageChannel.postMessage.call(this.messageChannel,e,t)?n():i()}catch(e){n()}}.bind(this))}function C(e,t,n){var s,r,o=i.createUniqueSequence("LPMSG_"+t+i.SEQUENCE_FORMAT);if(e.unshift(o,t),!N(t)||(1<e.length&&"function"==typeof e[e.length-1]?s=e.pop():2<e.length&&!isNaN(e[e.length-1])&&"function"==typeof e[e.length-2]&&(r=parseInt(e.pop(),10),s=e.pop()),!s||this.callbackCache.set(o,s,r,function(e,t){n(),w.call(this,e,t)}.bind(this))))return this.mapper.toMessage.apply(this.mapper,e)}function N(e){return f===e||d===e}function w(e,t){if(e&&"function"==typeof t)try{t.call(null,new Error("Callback: Operation Timeout!"))}catch(e){i.log("Error while trying to handle the timeout using the callback","ERROR","PostMessageCourier")}}function E(e,t){var n=this.callbackCache.get(e,!0),s=t&&t.args;if("function"==typeof n){s&&s.length&&s[0]&&"Error"===s[0].type&&"string"==typeof s[0].message&&(s[0]=new Error(s[0].message));try{n.apply(null,s)}catch(e){i.log("Error while trying to handle the returned message from request/command","ERROR","PostMessageCourier")}}}function R(e,t,i){return function(n,s){var r,o,a=n;n instanceof Error&&(a={type:"Error",message:n.message}),o=[e,p,a],f===t&&o.push(s),r=this.mapper.toMessage.apply(this.mapper,o),b.call(this,r,i.source)}.bind(this)}function O(e,t,i,n){var s,r;"undefined"!=typeof Promise&&i instanceof Promise||i instanceof a?i.then(function(i){r=[e,p,null],f===t&&r.push(i),s=this.mapper.toMessage.apply(this.mapper,r),b.call(this,s,n.source)}.bind(this),function(t){r=[e,p,t],s=this.mapper.toMessage.apply(this.mapper,r),b.call(this,s,n.source)}.bind(this)):i&&i.error?(r=[e,p,i],s=this.mapper.toMessage.apply(this.mapper,r),b.call(this,s,n.source)):void 0!==i&&(r=[e,p,null],f===t&&r.push(i),s=this.mapper.toMessage.apply(this.mapper,r),b.call(this,s,n.source))}function P(e){return function(t){var n,s,r,o,a,h,c;if(t)if(a=t.method&&t.method.id,h=t.method&&t.method.name,c=t.method&&t.method.args,p===h)E.call(this,a,t.method);else{try{N(h)&&c.length&&c.push(R.call(this,a,h,t)),s=(n=e(t))&&n()}catch(e){i.log("Error while trying to invoke the handler on the events channel","ERROR","PostMessageCourier"),N(h)&&(r=[a,p,{error:e.toString()}],o=this.mapper.toMessage.apply(this.mapper,r),b.call(this,o,t.source))}N(h)&&void 0!==s&&O.call(this,a,h,s,t)}}}return{initialize:function(t){this.initialized||(t=t||{},c.call(this,t),l.call(this,t),m.call(this,t),g.call(this,t),e.call(this,this.eventChannel),this.once=this.eventChannel.once,this.hasFiredEvents=this.eventChannel.hasFiredEvents,this.bind=this.eventChannel.bind,this.register=this.eventChannel.register,this.unbind=this.eventChannel.unbind,this.unregister=this.eventChannel.unregister,this.hasFiredCommands=this.eventChannel.hasFiredCommands,this.comply=this.eventChannel.comply,this.stopComplying=this.eventChannel.stopComplying,this.hasFiredReqres=this.eventChannel.hasFiredReqres,this.reply=this.eventChannel.reply,this.stopReplying=this.eventChannel.stopReplying,this.initialized=!0)},getMessageChannel:function(){return this.messageChannel},getEventChannel:function(){return this.eventChannel},trigger:t,publish:t,command:function(){if(!this.disposed){var e=Array.prototype.slice.apply(arguments);return y.call(this,e,d)}},request:function(){if(!this.disposed){var e=Array.prototype.slice.apply(arguments);return y.call(this,e,f)}},dispose:function(){this.disposed||(this.messageChannel.dispose(),this.messageChannel=void 0,this.eventChannel=void 0,this.mapper=void 0,this.callbackCache=void 0,this.circuit=void 0,this.disposed=!0)}}}(),c||(t.PostMessageCourier=t.PostMessageCourier||l),l}));